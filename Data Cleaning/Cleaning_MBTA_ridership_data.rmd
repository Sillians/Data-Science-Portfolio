---
title: " Cleaning MBTA ridership data"
author: "Jane Kathambi"
date: "8 June 2018"
output: 
  html_document:
    keep_md: yes
    theme: united
    toc: yes
    number_sections: true
    toc_depth: 4
    toc_float:
      collapsed: yes
      smooth_scroll: yes
---


# Introduction
The Massachusetts Bay Transportation Authority ("MBTA" or just "the T" for short) manages America's oldest subway, as well as Greater Boston's commuter rail, ferry, and bus systems.

We are going to clean this data step by step as shown below:

1. **Understand the structure of the data.**
    + Look at the data strucutre and remove any unecessary data.
2. **Tidy the data** by making sure that the three principles of tidy data are followed.We will make sure that:

    + Each variable forms a column.
    + Each observation forms a row.
    + Each type of observational unit forms a table.

We will use tidyr functions which include:

* **Spread:** If column names are stored a sobservations spread them into key-value pairs
* **Gather:** If observations are stored as column names gather them into Key-Value Pairs.
* **Unite** to unite multiple columns into one column.
* **Separate** to separate one column into multiple columns

3. **Prepare the data for analysis.** We will make sure that:

    + Variables are of the correct data type
        + Dates are well formatted. We will use lubridate.
        + Column types are correct. We will use coersions.
    + Missing values are dealt with
    + Extreme values are dealt with
    + Unexpected values are dealt with


The Massachusetts Bay Transportation Authority ("MBTA") is stored as an Excel spreadsheet called mbta.xlsx in the data folder that is inside the data cleaning folder. We will use the read_excel() function from Hadley Wickham's readxl package to import it.

In most cases excel spreadhseets have some rows that need to be skipped e.g title, total. However, the first time one imports a dataset, they might not know how many rows need to be skipped. So one needs to import the data and explore the first few rows, identify the ones that need to be ommited and omit them and save the resulting data frame to a new name. If one knows how many rows to skip then they can go ahead and skip them while importing. 


# Loading the required packages

We will import the excel data using the readxl package. We will require tidyr for data cleaning contained in the tidyverse package

```{r}
#Load the readxl library
library(readxl)

#Load the tidyverse library
library(tidyverse)

```

# Importing the data

Go to the data folder and open the excel file. You will realise that the first row is a title row which need to be skipped while importing.

```{r}
# Import mbta.xlsx and skip first row. Save the resulting data frame as mbta.
mbta<-read_excel("data/mbta.xlsx", skip=1)

```

# Exploring the data

Lets check out how the data is. We do this having the three principles of tidy data in mind.
```{r}
# View the structure of mbta
glimpse(mbta)

# View the first 6 rows of mbta
head(mbta)

# View the entire data set or View(mbta)
fix(mbta)

# View a summary of mbta
summary(mbta)
```

The following issues have arised from exploring the data:

1. There is a unnecessary column. i.e the first column which lists the observations.
2. There are unnecessary rows:
    + All mode by Qtr row. This 1st row is a quarterly average of weekday MBTA ridership. Since this dataset tracks monthly average ridership, this row does not belong to this data frame. Furthermore, this explains why it has missing data.
    + Pct Chg / Yr row. This 7th row is not an observation but an analysis
    + TOTAL row. This 11th row is not an observation but an analysis. 
    
3. There is missing data.
    + There is missing data in 'All mode by Qtr' row. This dataset tracks monthly average ridership. However, this 1st row is a quarterly average of weekday MBTA ridership and this explains why it is has missing data.
4. Observations(values) i.e months are stored as columns rather than as rows.
5. Column names(variables) i.e *mode* are stored as rows rather than as columns.

# Cleaning the data
We tidy the data first, then prepare the data for data analysis.

## Tidying the data
In this section we are going to tidy the data by dealing with the above data quality issues from issue number 1 to number 5.

### Removing the unnecessary column

```{r}
# Remove the first column of mbta and save the new data frame as mbta1
mbta1<-mbta[, -1]

#view the changes
head(mbta1)

```

### Removing the unnecessary rows

```{r}
# Remove rows 1, 7, and 11 of mbta: mbta2
mbta2<-mbta1[-c(1,7,11),]

# view the changes
View(mbta2)
```

### Dealing with the missing data

There is missing data in 'All mode by Qtr' row. This dataset tracks monthly average ridership. However, this 1st row is a quarterly average of weekday MBTA ridership and this explains why it is has missing data.

We have already removed this row as a unnecessary row.

### Gathering the columns

Observations(values) i.e months are stored as columns rather than as rows.

Viewing mbta2 shows that the months themselves are observations but have been stored as varialbes/columns. You can tell that the months are observations because as you go through time, the month changes.

According to tidy data principles and as is customary, we should represent observations in rows rather than columns. We will use the gather() function from the tidyr package, to gather the columns of mbta2. We will also Use the - operator to omit the *mode* column. We will call our new columns *month* and *thou_riders* (for "thousand riders") and assign the result to mbta3.

```{r}
#view mbta2
View(mbta2)

# Gather columns of mbta2: mbta3. Leave out the *mode* column.
mbta3<-gather(mbta2, month, thou_riders, -mode)

# View the head of mbta3
head(mbta3)

```

Gathering has placed observations in rows.

### Spreading the columns

Column names(variables) i.e *mode* are stored as rows rather than as columns.

Viewing mbta3 shows that the *mode* themselves are column names (variable names) but have been stored as rows. You can tell that the *mode* are column names because as you go through time, the *mode* does not change.

According to tidy data principles and as is customary, we should represent variables in a column. We will use the spread() function from the tidyr package, to spread the *mode* column across multiple columns each column representing a variable. We will spread it on the variable *thou_riders*.

```{r}
#view mbta3
View(mbta3)

# Spread the mode column of mbta3: mbta4. 
mbta4<-spread(mbta3, mode, thou_riders)

# View the head of mbta4
head(mbta4)

```

Spreading has placed mode in columns.

The data is now tidy!!!

## Preparing the data for analysis.We will make sure that:

    + Variables are of the correct data type.
        + Dates are well formatted. We will use lubridate.
        + Column types are correct. We will use coersions.
    + Extreme values are dealt with.
    + Unexpected values are dealt with.

Before we begin let us explore our  tidy data set.

### Exploring our tidy data.

```{r}
# View the structure of mbta4
glimpse(mbta4)

# View the first 6 rows of mbta4
head(mbta4)

# View the entire data set or View(mbta4)
fix(mbta4)

#View the summary of mbta4
summary(mbta4)
```
