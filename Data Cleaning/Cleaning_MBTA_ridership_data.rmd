---
title: " Cleaning MBTA ridership data"
author: "Jane Kathambi"
date: "8 June 2018"
output: 
  html_document:
    keep_md: yes
    theme: united
    toc: yes
    toc_depth: 4
    toc_float:
      collapsed: yes
      smooth_scroll: yes
---

# .

# Introduction
The Massachusetts Bay Transportation Authority ("MBTA" or just "the T" for short) manages America's oldest subway, as well as Greater Boston's commuter rail, ferry, and bus systems.

We are going to clean this data step by step as shown below:

1. **Understand the structure of the data.**
    + Look at the data strucutre and remove any unecessary data.
2. **Tidy the data** by making sure that the three principles of tidy data are followed.We will make sure that:

    + Each variable forms a column.
    + Each observation forms a row.
    + Each type of observational unit forms a table.

We will use tidyr functions which include:

* **Spread:** If values are stored as column names instead of being values, spread them into key-value pairs
* **Gather:** If column names are stored as values (instead of being column names), gather them into Key-Value Pairs.
* **Unite** to unite multiple columns into one column.
* **Separate** to separateone column into multiple columns

3. **Prepare the data for analysis.** We will make sure that:

    + Dates are well formatted. We will use lubridate and stringr if necessary
    + Column types are correct. We will use coersions.
    + Missing values are dealt with
    + Extreme values are dealt with
    + Unexpected values are dealt with


The Massachusetts Bay Transportation Authority ("MBTA") is stored as an Excel spreadsheet called mbta.xlsx in the data folder that is inside the data cleaning folder. We will use the read_excel() function from Hadley Wickham's readxl package to import it.

In most cases excel spreadhseets have some rows that need to be skipped e.g title, total. However, the first time one imports a dataset, they might not know how many rows need to be skipped. So one needs to import the data and explore the first few rows, identify the ones that need to be ommited and omit them and save the resulting data frame to a new name. If one knows how many rows to skip then they can go ahead and skip them while importing. 


# Loading the required packages

We will import the excel data using the readxl package. We will require tidyr for data cleaning contained in the tidyverse package

```{r}
#Load the readxl library
library(readxl)

#Load the tidyverse library
library(tidyr)

```

# Importing the data

Go to the data folder and open the excel file. You will realise that the first row is a title row which need to be skipped while importing.

```{r}
# Import mbta.xlsx and skip first row. Save the resulting data frame as mbta.
mbta<-read_excel("data/mbta.xlsx", skip=1)

```

# Exploring the data
Lets check out how the data is. We do this having the three principles of tidy data in mind.
```{r}
# View the structure of mbta
glimpse(mbta)

# View the first 6 rows of mbta
head(mbta)

# View the entire data set or View(mbta)
fix(mbta)

# View a summary of mbta
summary(mbta)
```

The following issues have arised from exploring the data:

1. There is a unnecessary column. i.e the first column which lists the observations.
2. There are unnecessary rows:
    + All Modes by Qtr row. This 1st row is a quarterly average of weekday MBTA ridership. Since this dataset tracks monthly average ridership, this row does not belong to this data frame. Furthermore, this explains why it has missing data.
    + Pct Chg / Yr row. This 7th row is not an observation but an analysis
    + TOTAL row. This 11th row is not an observation but an analysis. 
    
3. There is missing data.
    + There is missing data in 'All Modes by Qtr' row. This dataset tracks monthly average ridership. However, this 1st row is a quarterly average of weekday MBTA ridership and this explains why it is has missing data.
4. observations(values) are stored as columns rather than as rows.

# Cleaning the data
In this section we are going to deal with the above data quality issues.

## 1. Removing the unnecessary column
```{r}
# Remove the first column of mbta and save the new data frame as mbta1
mbta1<-mbta[, -1]

```

## 2. Removing the unnecessary rows

```{r}
# Remove rows 1, 7, and 11 of mbta: mbta2
mbta2<-mbta1[-c(1,7,11),]
```

## 3. Dealing with the missing data
There is missing data in 'All Modes by Qtr' row. This dataset tracks monthly average ridership. However, this 1st row is a quarterly average of weekday MBTA ridership and this explains why it is has missing data.

We have already removed this row as a unnecessary row.